/*! MovieList - v0.0.1 - 2014-01-17 */
var Movie=Backbone.Model.extend({urlRoot:"/movie",idAttribute:"id"}),MovieCollection=Backbone.Collection.extend({model:Movie,url:"/movie",initialize:function(a){a&&(this.url=this.url+"/"+a.type+"/"+a.value)}}),HeaderView=Backbone.View.extend({className:"ui grid center aligned",initialize:function(){this.render()},render:function(){return this.$el.html(this.template()),this},events:{"click .item:not(.disabled)":"visitPage"},selectMenuItem:function(a){this.$("a").removeClass("active"),this.$("a.item[data-page='"+a+"']").addClass("active")},visitPage:function(a){var b=a.currentTarget.dataset.page;app.navigate(b,{trigger:!0,replace:!0})}}),MovieView=Backbone.View.extend({initialize:function(){this.render()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},className:"ui grid",events:{"click .back":"back","click .extra-info a":"switchTab","click .sort-by":"sortBy"},switchTab:function(a){var b=$(a.target).data("tab"),c=this.$(".extra-info");c.find(".active").removeClass("active").end().find('[data-tab="'+b+'"]').addClass("active")},back:function(){app.back()},sortBy:function(a){var b=$(a.target);app.navigate(b.data("sort")+"/"+b.data("value"),{trigger:!0})}}),MovieListView=Backbone.View.extend({initialize:function(a){this.options=a||{},this.render()},className:"ui grid five column",events:{"click .shape":"detailInfo","mouseenter .shape":"cover","mouseleave .shape":"cover"},cover:function(a){var b=$(a.target).closest(".ui.shape"),c=b.shape("is animating"),d="mouseenter"===a.type?"back":"over";c?b.shape("queue","flip "+d):b.shape("flip "+d)},detailInfo:function(a){var b=$(a.target).closest(".ui.shape").data("id");b&&app.navigate("movies/"+b,{trigger:!0})},render:function(){var a,b,c=this.model.models,d=c.length;this.options.page?(a=(this.options.page-1)*utils.per_page,b=Math.min(a+utils.per_page,d)):(a=0,b=d);for(var e=a;b>e;e++)this.$el.append(new MovieListItemView({model:c[e]}).render().el);return this}}),MovieListItemView=Backbone.View.extend({className:"column",render:function(){return this.$el.html(this.template(this.model.toJSON())),this}}),PaginatorView=Backbone.View.extend({className:"ui divided horizontal list",initialize:function(a){this.options=a||{}},events:{"click .ui.button":"visitPage"},visitPage:function(a){var b=$(a.target).data("page_id");app.navigate("movies/page/"+b,{trigger:!0})},render:function(){for(var a=this.model.models,b=a.length,c=Math.ceil(b/utils.per_page),d=0;c>d;d++)this.$el.append(this.template({pageId:d+1,current:this.options.page}));return this}}),utils={per_page:20,format_text:function(a){return a.length>=270&&(a=a.substr(0,270)+"..."),a},loadTemplate:function(a,b){var c=[];$.each(a,function(a,b){window[b]?c.push($.get("tpl/"+b+".html",function(a){window[b].prototype.template=_.template(a)})):console.log(b+" not found")}),$.when.apply(null,c).done(b)}},AppRouter=Backbone.Router.extend({routes:{"":"list",movies:"list","year(/:value)":"byyear","genre(/:value)":"bygenre","director(/:value)":"bydirector","country(/:value)":"bycountry","movies/page/:page":"list","movies/:id":"movieDetails"},list:function(a){var b=a?parseInt(a,10):1,c=new MovieCollection;c.fetch({success:function(){$("#content").html(new MovieListView({model:c,page:b}).el).append('<div class="ui horizontal icon divider"><i class="circular asterisk icon"></i></div>').append(new PaginatorView({model:c,page:b}).render().el)}}),this.headerView.selectMenuItem("movies")},byyear:function(a){var b=new MovieCollection({type:"year",value:a});b.fetch({success:function(){$("#content").html(new MovieListView({model:b}).el)}}),this.headerView.selectMenuItem("year")},bygenre:function(a){var b=new MovieCollection({type:"genre",value:a});b.fetch({success:function(){$("#content").html(new MovieListView({model:b}).el)}}),this.headerView.selectMenuItem("genre")},bydirector:function(a){var b=new MovieCollection({type:"director",value:a});b.fetch({success:function(){$("#content").html(new MovieListView({model:b}).el)}}),this.headerView.selectMenuItem("director")},bycountry:function(a){var b=new MovieCollection({type:"country",value:a});b.fetch({success:function(){$("#content").html(new MovieListView({model:b}).el)}}),this.headerView.selectMenuItem("country")},movieDetails:function(a){var b=new Movie({id:a});b.fetch({success:function(){$("#content").html(new MovieView({model:b}).el)}}),this.headerView.selectMenuItem("details")},initialize:function(){this.headerView=new HeaderView,this.routesHit=0,$("#header").html(this.headerView.el),Backbone.history.on("route",function(){this.routesHit++},this)},back:function(){this.routesHit>1?window.history.back():this.navigate("movies",{trigger:!0,replace:!0})}});utils.loadTemplate(["MovieView","MovieListItemView","PaginatorView","HeaderView"],function(){app=new AppRouter,Backbone.history.start()});